##
## Configuration for public/service/postfix
##

modify "public/config/firewall"

[files]
mkdir   += "/etc/postfix/maps"
rm      += "/etc/aliases"
rm      += "/etc/aliases.db"

if PLATFORM_OS_APT_BASED
  [apt]
  install += "postfix"
else
  unsupported()
end

[trigger.reload-postfix]
files += "/etc/postfix/*.cf"
files += "/etc/postfix/maps/default-forward"
command = ["/etc/init.d/postfix", "reload"]

[trigger.postfix-maps-aliases]
files += "/etc/postfix/maps/aliases"
conditions += "[[ ! -f /etc/postfix/maps/aliases.db ]]"
command = ["postalias", "/etc/postfix/maps/aliases"]

[trigger.postfix-maps-transport]
files += "/etc/postfix/maps/transport"
conditions += "[[ ! -f /etc/postfix/maps/transport.db ]]"
command = ["postmap", "/etc/postfix/maps/transport"]

[trigger.postfix-maps-blacklist-exceptions]
files += "/etc/postfix/maps/blacklist-exceptions"
conditions += "[[ ! -f /etc/postfix/maps/blacklist-exceptions.db ]]"
command = ["postmap", "/etc/postfix/maps/blacklist-exceptions"]

[trigger.postfix-maps-ssl-passwords]
files += "/etc/postfix/maps/ssl-passwords"
conditions += "[[ ! -f /etc/postfix/maps/ssl-passwords.db ]]"
command = ["postmap", "/etc/postfix/maps/ssl-passwords"]

[trigger.postfix-maps-inbound-accept]
files += "/etc/postfix/maps/inbound-accept"
conditions += "[[ ! -f /etc/postfix/maps/inbound-accept.db ]]"
command = ["postmap", "/etc/postfix/maps/inbound-accept"]

[trigger.postfix-maps-inbound-sender-access]
files += "/etc/postfix/maps/inbound-sender-access"
conditions += "[[ ! -f /etc/postfix/maps/inbound-sender-access.db ]]"
command = ["postmap", "/etc/postfix/maps/inbound-sender-access"]

[trigger.postfix-maps-virtual]
files += "/etc/postfix/maps/virtual"
conditions += "[[ ! -f /etc/postfix/maps/virtual.db ]]"
command = ["postmap", "/etc/postfix/maps/virtual"]

[trigger.postfix-maps-recipient-access]
files += "/etc/postfix/maps/recipient-access"
conditions += "[[ -f /etc/postfix/maps/recipient-access && ! -f /etc/postfix/maps/recipient-access.db ]]"
command = ["postmap", "/etc/postfix/maps/recipient-access"]

[settings]
## Required defines
#myhostname = example.org
#root_destination    = ["staff@example.org"]

## Optional defines
content_filter        = ""
content_filter_acl    = ["127.0.0.0/8"]
smtp_banner           = ""
rbl_lists             = []
mynetworks            = ["127.0.0.0/8"]
relay_host            = ""
message_size_limit    = "20480000"
mydestination         = ["localhost", "$myhostname"]
header_checks         = ["regexp:/etc/postfix/maps/anti-av-headerchecks"]
pgsql_support         = 0
ssl_support           = 0
recipient_access      = 0
relay_domains         = []
relay_username        = ""
relay_password        = ""
aliases               = []
autoreply_support     = 0
inbound_accept        = []
inbound_sender_access = []
alias_databases       = ["hash:/etc/postfix/maps/aliases"]
default_forward       = "root"
root_aliases          = []
transport_lines       = []
custom_lines          = []
virtual_alias_domains = []
virtual_aliases       = []
virtual_alias_support = 0
mailman_domains       = []
if PLATFORM_OS_NAME in ["debian", "ubuntu"]
  chroot_daemons      = "-"
else
  chroot_daemons      = "n"
end
settings              = dict()

blacklist_exceptions = []
blacklist_exceptions += "pasmtp.tele.dk"
blacklist_exceptions += "pasmtpa.tele.dk"
blacklist_exceptions += "pasmtpb.tele.dk"
blacklist_exceptions += "mx01.stofanet.dk"
blacklist_exceptions += "mx02.stofanet.dk"
blacklist_exceptions += "mx03.stofanet.dk"
blacklist_exceptions += "mx04.stofanet.dk"
blacklist_exceptions += "mx05.stofanet.dk"
blacklist_exceptions += "mx06.stofanet.dk"


