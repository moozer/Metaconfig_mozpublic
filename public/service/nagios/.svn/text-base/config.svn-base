##
## Configuration for public/service/nagios
##

[apt]
install += "nagios3"
install += "nagios-plugins"
install += "nagios-plugins-basic"
install += "nagios-plugins-standard"
install += "nagiosgrapher"

[files]
mkdir += "/etc/nagios3/hosts.d"
rm += "/etc/nagios3/apache2.conf"
mkdir += "/var/lib/nagios3/rw"
permission["/var/lib/nagios3/rw"] = "2710"

[trigger.restart-nagios3]
files += "/etc/nagios3/*"
files += "/etc/nagios3/*/*"
command = ["invoke-rc.d", "nagios3", "restart"]

[settings]
htpasswords = dict()
hosts       = dict()

service_perfdata_command = None

# Host groups
groups = dict()
groups["http" ] = dict(alias = "HTTP servers", members = [])
groups["https"] = dict(alias = "HTTPS servers", members = [])
groups["ssh"  ] = dict(alias = "SSH servers", members = [])
groups["pop"  ] = dict(alias = "POP3 servers", members = [])
groups["imap" ] = dict(alias = "IMAP servers", members = [])
groups["smtp" ] = dict(alias = "SMTP servers", members = [])
groups["ntp"  ] = dict(alias = "NTP servers", members = [])
groups["dns"  ] = dict(alias = "DNS servers", members = [])
groups["mysql"] = dict(alias = "MySQL servers", members = [])
groups["pgsql"] = dict(alias = "PostgreSQL servers", members = [])
groups["ftp"  ] = dict(alias = "FTP servers", members = [])
## nagios doesn't like monitoring hosts without services, so this is
## a group for devices that have no other "services" monitorable
## (like routers w/out snmp for example)
groups["ping_slow" ] = dict(alias = "Pingable servers", members = [".*"])

services = dict()
services["http"  ] = dict(desc = "HTTP",  check = "check_http")
services["https" ] = dict(desc = "HTTPS", check = "check_https")
services["ssh"   ] = dict(desc = "SSH",   check = "check_ssh")
services["ping"  ] = dict(desc = "PING",  check = "check_ping!300.0,40%!700.0,80%")
services["ping_slow"] = dict(desc = "PING_SLOW",  check = "check_ping!3000.0,40%!7000.0,80%")
services["pop"   ] = dict(desc = "SPOP",  check = "check_spop")
services["imap"  ] = dict(desc = "SIMAP", check = "check_simap")
services["smtp"  ] = dict(desc = "SSMTP", check = "check_ssmtp")
services["ntp"   ] = dict(desc = "NTP",   check = "check_ntp")
services["dns"   ] = dict(desc = "DNS",   check = "check_dig!google.com")
services["mysql" ] = dict(desc = "MYSQL", check = "check_mysql")
services["pgsql" ] = dict(desc = "PGSQL", check = "check_pgsql_with_login!nagios!nagios")

commands = dict()
commands["check_pgsql_with_login"] = dict(command = "/usr/lib/nagios/plugins/check_pgsql -H '$HOSTADDRESS$' -l '$ARG1$' -p '$ARG2$'")
commands["check_https_with_login"] = dict(command = "/usr/lib/nagios/plugins/check_http -H '$HOSTADDRESS$' -a '$ARG1$:$ARG2$'")

